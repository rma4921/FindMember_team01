<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세보기</title>
    <link rel="stylesheet" href="/css/detail.css">
    <link rel="stylesheet" href="/css/modal.css">
</head>
<body>


<div class="detail-container">
    <div class="detail-header">
        <div class="header-top">
            <h2 th:text="${recruitment.title}"></h2>
            <div class="detail-meta">
                <!-- 작성일과 수정일 비교 -->
                <th:block th:if="${recruitment.createdAt == recruitment.updatedAt}">
                    <span>작성일 [[${#temporals.format(recruitment.createdAt, 'yy.MM.dd HH:mm')}]]</span>
                </th:block>
                <th:block th:if="${recruitment.createdAt != recruitment.updatedAt}">
                    <span>수정일 [[${#temporals.format(recruitment.updatedAt, 'yy.MM.dd HH:mm')}]]</span>
                </th:block>
                <span th:text="${recruitment.status ? '모집중' : '모집 완료'}">모집중</span>
            </div>
        </div>
        <div class="header-actions">
            <!-- 왼쪽 영역: 수정/삭제 -->
            <div class="left-actions">
                <div class="application-buttons"
                     th:if="${session.memberId == recruitment.memberId}">
                    <button class="btn-edit" onclick="openEditModal()">수정</button>
                    <form id="deleteForm"
                          th:action="@{/api/posts/{id}(id=${recruitment.recruitmentId})}"
                          method="post"
                          onsubmit="return confirmDelete();">
                        <input type="hidden" name="_method" value="DELETE"/>
                        <button type="submit" class="btn-delete">삭제</button>
                    </form>
                </div>
            </div>

            <!-- 오른쪽 영역: 지원/신고 -->
            <div class="right-actions">
                <div th:if="${session.memberId == recruitment.memberId}">
                    <a th:href="@{/api/posts/{id}/apply(id=${recruitment.recruitmentId})}"
                       class="apply-button">지원서 확인</a>
                </div>
                <div th:if="${session.memberId != recruitment.memberId}">
                    <th:block th:if="${memberLevel >= recruitment.level}">
                        <button type="button" id="applyButton" class="apply-button"
                                onclick="openApplyModal()">지원 하기
                        </button>
                    </th:block>
                    <th:block th:if="${memberLevel < recruitment.level}">
                        <span class="level-warning">⚠️ 이 모집글은 레벨 [[${recruitment.level}]] 이상만 지원할 수 있습니다.</span>
                    </th:block>
                </div>
                <div class="like-report">
                    <a href="#">신고</a>
                </div>
            </div>
        </div>


    </div>

    <div class="detail-content">
        <p th:text="${recruitment.content}">프로젝트 내용</p>
    </div>
    <div class="header-top header-row">
        <a th:href="@{/api/posts}" class="btn btn-back">뒤로가기</a>
    </div>
</div>
<div id="modalOverlay" class="modal-overlay"></div>
<div id="editModal" class="modal-box" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>글 수정하기</h2>
        <form id="editForm" th:action="@{/api/posts/{id}(id=${recruitment.recruitmentId})}"
              method="post">
            <input type="hidden" name="_method" value="PUT"/>
            <input type="text" name="title" th:value="${recruitment.title}" required><br>
            <textarea name="content" required th:text="${recruitment.content}"></textarea><br>
            <input type="datetime-local"
                   th:text="${#temporals.format(recruitment.updatedAt, 'yyyy-MM-dd HH:mm')}"/><br>
            <select name="status">
                <option value="true" th:selected="${recruitment.status} == true">모집중</option>
                <option value="false" th:selected="${recruitment.status} == false">모집완료</option>
            </select><br>
            <input type="number" name="level" th:value="${recruitment.level}"><br>
            <div class="modal-button-row">
                <button type="button" class="btn-cancel" onclick="closeEditModal()">취소</button>
                <button type="submit" class="btn-submit">수정 완료</button>
            </div>
        </form>
    </div>
</div>
<div id="modalOverlay2" class="modal-overlay"></div>
<div id="applyModal" class="modal-box" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeApplyModal()">&times;</span>

        <!-- 상단 제목 -->
        <h2 class="modal-heading">팀 프로젝트</h2>

        <!-- 연두색 안내 박스 -->
        <div class="alert-box success-alert">
            아래 양식을 참고해 지원서를 작성해주세요.
        </div>

        <form id="applyForm"
              th:action="@{/api/posts/{id}/apply(id=${recruitment.recruitmentId})}"
              method="post"
              onsubmit="changeApplyButton()">

            <!-- 제목 입력 -->
            <div class="title-input readonly-text" th:text="${recruitment.title}">모집글 제목</div>

            <!-- 툴바 -->
            <div class="toolbar">
                <button type="button">B</button>
                <button type="button">I</button>
                <button type="button">S</button>
                <button type="button">링크</button>
                <button type="button">H1</button>
                <button type="button">H2</button>
                <button type="button">번호</button>
                <button type="button">글머리</button>
                <button type="button">구분선</button>
                <button type="button">코드</button>
            </div>

            <!-- 본문 입력 -->
            <textarea name="content" class="editor-content" rows="18" required>
- 원하는 역할 :
- 프로젝트 진행 횟수 :
- 프로젝트 경험 :
- 자기 소개 등 :
- 모집 인원 :
- 프로젝트 관련 주의사항 :
</textarea>


            <!-- 버튼 -->
            <div class="modal-button-row">
                <button type="button" class="btn-cancel" onclick="closeApplyModal()">취소</button>
                <button type="submit" class="btn-submit">지원하기</button>
            </div>
        </form>
    </div>
</div>


<script src="/js/detail.js"></script>
</body>
</html>